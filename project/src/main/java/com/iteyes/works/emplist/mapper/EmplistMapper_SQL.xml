<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.iteyes.works.emplist.mapper.EmplistMapper">

	<select id="getListCount" resultType="int">
		SELECT COUNT(ROWNUM)  	/*전체 ROW 개수*/
		  FROM STE100I	                            			
	</select>
		
		
	<select id="getEmpSearchList" resultType="HashMap">
	WITH T AS(
		SELECT COUNT(*) OVER() AS CNT
              ,ROW_NUMBER() OVER(
		                 ORDER BY TO_NUMBER(EMP_NO),EMP_NAME ASC) AS RWNUM
             , NVL(EMP_NO , '-') AS EMP_NO
		     , NVL(EMP_NAME , '-') AS EMP_NAME
		     , NVL(COMP_EMAIL , '-') AS COMP_EMAIL
		     , NVL(CNTCT_NO , '-') AS CNTCT_NO
		     , NVL(EMP_STTS_NAME , '-') AS EMP_STTS_NAME
		     , NVL(RNK_NAME , '-') AS RNK_NAME
             , NVL(DPT_NAME , '-') AS DPT_NAME
		  FROM (SELECT  E.JOIN_DATE AS JOIN_DATE
		             , E.EMP_NO AS EMP_NO 										 /*사원번호*/
		             , E.EMP_NAME AS EMP_NAME 									 /*사원명*/
		             , E.COMP_EMAIL AS COMP_EMAIL 								 /*이메일*/
		             , E.CNTCT_NO AS CNTCT_NO 									 /*연락처*/
		             , (SELECT C2.CODE_NAME
		                  FROM STC002C C2
		                 WHERE CODE_GRP_ID = 'EMP_STTS_CODE'
		                   AND E.EMP_STTS_CODE = C2.CODE_ID ) AS EMP_STTS_NAME 	 /*상태*/
		             , (SELECT C2.CODE_NAME
		                  FROM STC002C C2
		                 WHERE CODE_GRP_ID = 'RNK_CODE'
		                   AND E.RNK_CODE = C2.CODE_ID ) AS RNK_NAME 			 /*직급*/	
                     , (SELECT WM_CONCAT(D.DPT_NAME)
                              FROM STC003I D
                                 , STE101I P
                             WHERE 1 = 1
                               AND D.DPT_CODE = P.DPT_CODE
                               AND D.APLY_STRT_DATE = P.APLY_STRT_DATE
                           AND P.EMP_NO = E.EMP_NO
                           ) AS DPT_NAME
		          FROM STE100I E
		         WHERE 1 = 1		           
		           )
		   WHERE 1 = 1
            <if test = ' searchDrop.equals("emp_name") '>	   
		  AND EMP_NAME LIKE '%' || #{searchText} || '%'
		</if>
		<if test = ' searchDrop.equals("dpt_name") '>	   
		  AND DPT_NAME LIKE '%' || #{searchText} || '%'
		</if>
		<if test = ' searchDrop.equals("emp_stts_code") '>	   
		  AND EMP_STTS_NAME = #{searchText} 
		</if>       
       )
       SELECT T.*
       FROM T   
       WHERE 1 = 1	
         AND RWNUM BETWEEN ((#{page}-1)*#{row})+1 AND #{page}*#{row}
	</select>
</mapper>


